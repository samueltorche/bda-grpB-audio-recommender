{"paragraphs":[{"text":"%md\n# MBA with audioscrobbler\n## imports","user":"anonymous","dateUpdated":"2020-06-12T10:33:08+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1590749114709_2034108693","id":"20200529-104514_1832634434","dateCreated":"2020-05-29T10:45:14+0000","dateStarted":"2020-06-12T10:33:09+0000","dateFinished":"2020-06-12T10:33:09+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3041","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>MBA with audioscrobbler</h1>\n<h2>imports</h2>\n</div>"}]}},{"text":"import org.apache.spark.sql.Dataset\nimport org.apache.spark.sql.Row\nimport org.apache.spark.sql.functions._\nimport org.apache.spark.sql.types._\nimport scala.util.Random\nimport org.apache.spark.mllib.fpm.AssociationRules\nimport org.apache.spark.ml.fpm.FPGrowth","user":"anonymous","dateUpdated":"2020-06-12T10:33:09+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1590749036482_-1759570951","id":"20200529-104356_357249297","dateCreated":"2020-05-29T10:43:56+0000","dateStarted":"2020-06-12T10:33:09+0000","dateFinished":"2020-06-12T10:33:09+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3042","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.Dataset\nimport org.apache.spark.sql.Row\nimport org.apache.spark.sql.functions._\nimport org.apache.spark.sql.types._\nimport scala.util.Random\nimport org.apache.spark.mllib.fpm.AssociationRules\nimport org.apache.spark.ml.fpm.FPGrowth\n"}]}},{"text":"%md\n# Load data","user":"anonymous","dateUpdated":"2020-06-12T10:33:09+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false,"completionKey":"TAB"},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1590749059460_648103850","id":"20200529-104419_1869762308","dateCreated":"2020-05-29T10:44:19+0000","dateStarted":"2020-06-12T10:33:09+0000","dateFinished":"2020-06-12T10:33:09+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3043","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Load data</h1>\n</div>"}]}},{"text":"// Load the play count schema\nval rawPlayCounts = spark.sparkContext.textFile(\"/data/user_artist_data.txt\")\nval rawArtistData = spark.sparkContext.textFile(\"/data/artist_data.txt\")\nval rawArtistAlias = spark.sparkContext.textFile(\"/data/artist_alias.txt\")\nrawPlayCounts.take(5).foreach(println)","user":"anonymous","dateUpdated":"2020-06-12T10:33:09+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","editorHide":false,"tableHide":false},"settings":{"params":{},"forms":{}},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=285"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1590749194903_-1488373091","id":"20200529-104634_2049879777","dateCreated":"2020-05-29T10:46:34+0000","dateStarted":"2020-06-12T10:33:09+0000","dateFinished":"2020-06-12T10:33:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3044","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"1000002 1 55\n1000002 1000006 33\n1000002 1000007 8\n1000002 1000009 144\n1000002 1000010 314\nrawPlayCounts: org.apache.spark.rdd.RDD[String] = /data/user_artist_data.txt MapPartitionsRDD[1414] at textFile at <console>:59\nrawArtistData: org.apache.spark.rdd.RDD[String] = /data/artist_data.txt MapPartitionsRDD[1416] at textFile at <console>:60\nrawArtistAlias: org.apache.spark.rdd.RDD[String] = /data/artist_alias.txt MapPartitionsRDD[1418] at textFile at <console>:61\n"}]}},{"text":"%md\n## Convert to DataSet","user":"anonymous","dateUpdated":"2020-06-12T10:33:10+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1590749241759_-1847855583","id":"20200529-104721_2063844306","dateCreated":"2020-05-29T10:47:21+0000","dateStarted":"2020-06-12T10:33:10+0000","dateFinished":"2020-06-12T10:33:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3045","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Convert to DataSet</h2>\n</div>"}]}},{"text":"val artistByID = rawArtistData.flatMap { line =>\n    val (id, name) = line.span(_ != '\\t')\n    if (name.isEmpty()){\n        None\n    } else {\n        try {\n            Some((id.toInt, name.trim))\n        } catch{\n            case _: NumberFormatException => None\n        }\n  }\n}.toDF(\"id\", \"name\").cache()","user":"anonymous","dateUpdated":"2020-06-12T10:33:10+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1590750341363_930356056","id":"20200529-110541_825106953","dateCreated":"2020-05-29T11:05:41+0000","dateStarted":"2020-06-12T10:33:10+0000","dateFinished":"2020-06-12T10:33:11+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3046","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"artistByID: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [id: int, name: string]\n"}]}},{"text":"val artistAlias = rawArtistAlias.flatMap { line =>\n      var Array(artist, alias) = line.split('\\t')\n      if (artist.isEmpty()) {\n        None\n      } else {\n        Some((artist.toInt, alias.toInt))\n      }\n}.collect().toMap\nval bArtistAlias = spark.sparkContext.broadcast(artistAlias)","user":"anonymous","dateUpdated":"2020-06-12T10:33:11+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=286"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1590751073512_1241446847","id":"20200529-111753_1097578992","dateCreated":"2020-05-29T11:17:53+0000","dateStarted":"2020-06-12T10:33:11+0000","dateFinished":"2020-06-12T10:33:14+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3047","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"artistAlias: scala.collection.immutable.Map[Int,Int] = Map(1208690 -> 1003926, 2012757 -> 4569, 6949139 -> 1085752, 1109727 -> 1239120, 6772751 -> 1244705, 2070533 -> 1021544, 1157679 -> 2194, 9969617 -> 5630, 2034496 -> 1116214, 6764342 -> 40, 1272489 -> 1278238, 2108744 -> 1009267, 10349857 -> 1000052, 2145319 -> 1020463, 2126338 -> 2717, 10165456 -> 1001169, 6779368 -> 1239506, 10278137 -> 1001523, 9939075 -> 1329390, 2037201 -> 1274155, 1248585 -> 2885, 1106945 -> 1399, 6811322 -> 1019016, 9978396 -> 1784, 6676961 -> 1086433, 2117821 -> 2611, 6863616 -> 1277013, 6895480 -> 1000993, 6831632 -> 1246136, 1001719 -> 1009727, 10135633 -> 4250, 7029291 -> 1034635, 6967939 -> 1002734, 6864694 -> 1017311, 1237279 -> 1029752, 6793956 -> 1283231, 1208609 -> 1000699, 6693428 -> 1100258, 685174..."}]}},{"text":"val userArtist = rawPlayCounts.map { line =>\n    val Array(userId, artistID, count) = line.split(' ').map(_.toInt)\n    val finalArtistID = bArtistAlias.value.getOrElse(artistID, artistID)\n    (userId, artistID, count)\n}.toDF(\"user\", \"artist\", \"count\")\n\nuserArtist.show(5)\n\n// val userArtistDF = userArtist.join(artistByID, userArtist.col(\"artist\") === artistByID.col(\"id\")).select(\"user\", \"name\", \"count\").withColumnRenamed(\"name\", \"artist\")\nval userArtistDF = userArtist\n\nuserArtistDF.show(5)\n           \nuserArtistDF.cache()","user":"anonymous","dateUpdated":"2020-06-12T10:33:14+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=287","http://172.17.0.2:4040/jobs/job?id=288"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1590751693610_977194535","id":"20200529-112813_127150251","dateCreated":"2020-05-29T11:28:13+0000","dateStarted":"2020-06-12T10:33:14+0000","dateFinished":"2020-06-12T10:33:21+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3048","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+-------+-----+\n|   user| artist|count|\n+-------+-------+-----+\n|1000002|      1|   55|\n|1000002|1000006|   33|\n|1000002|1000007|    8|\n|1000002|1000009|  144|\n|1000002|1000010|  314|\n+-------+-------+-----+\nonly showing top 5 rows\n\n+-------+-------+-----+\n|   user| artist|count|\n+-------+-------+-----+\n|1000002|      1|   55|\n|1000002|1000006|   33|\n|1000002|1000007|    8|\n|1000002|1000009|  144|\n|1000002|1000010|  314|\n+-------+-------+-----+\nonly showing top 5 rows\n\nuserArtist: org.apache.spark.sql.DataFrame = [user: int, artist: int ... 1 more field]\nuserArtistDF: org.apache.spark.sql.DataFrame = [user: int, artist: int ... 1 more field]\nres33: userArtistDF.type = [user: int, artist: int ... 1 more field]\n"}]}},{"text":"%md\n# Create transactions","user":"anonymous","dateUpdated":"2020-06-12T10:33:21+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1590750459925_1348152663","id":"20200529-110739_1451215536","dateCreated":"2020-05-29T11:07:39+0000","dateStarted":"2020-06-12T10:33:21+0000","dateFinished":"2020-06-12T10:33:21+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3049","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Create transactions</h1>\n</div>"}]}},{"text":"%md\n### Create subset of data","user":"anonymous","dateUpdated":"2020-06-12T10:33:21+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591350613352_-1039824011","id":"20200605-095013_1690233988","dateCreated":"2020-06-05T09:50:13+0000","dateStarted":"2020-06-12T10:33:21+0000","dateFinished":"2020-06-12T10:33:21+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3050","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Create subset of data</h3>\n</div>"}]}},{"text":"val userArtistSubsetDF = userArtistDF.limit(5000000)\nval transactions = userArtistSubsetDF.withColumn(\"combined\", $\"artist\").groupBy(\"user\").agg(collect_list($\"combined\").alias(\"items\"))\ntransactions.cache()\ntransactions.show(10)\ntransactions.count()","user":"anonymous","dateUpdated":"2020-06-12T10:33:21+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=289","http://172.17.0.2:4040/jobs/job?id=290"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1591350239973_-644902498","id":"20200605-094359_678083187","dateCreated":"2020-06-05T09:43:59+0000","dateStarted":"2020-06-12T10:33:21+0000","dateFinished":"2020-06-12T10:36:03+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3051","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----+--------------------+\n| user|               items|\n+-----+--------------------+\n| 1014|[1000382, 1000416...|\n|10015|[1000188, 1000201...|\n|10016|[1, 1000010, 1000...|\n|10025|[1007505, 1009401...|\n|10027|[1000241, 1000429...|\n|10103|[1000010, 1000062...|\n|10137|[1000591, 1000822...|\n|10142|[1000130, 1000192...|\n|10201|[1000429, 1004241...|\n|10211|[1000014, 1000024...|\n+-----+--------------------+\nonly showing top 10 rows\n\nuserArtistSubsetDF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [user: int, artist: int ... 1 more field]\ntransactions: org.apache.spark.sql.DataFrame = [user: int, items: array<int>]\nres34: Long = 21117\n"}]}},{"text":"%md\n## Create FPGrowth model for frequent pattern mining","user":"anonymous","dateUpdated":"2020-06-12T10:36:03+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1590750858376_995039256","id":"20200529-111418_2096367753","dateCreated":"2020-05-29T11:14:18+0000","dateStarted":"2020-06-12T10:36:03+0000","dateFinished":"2020-06-12T10:36:03+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3052","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Create FPGrowth model for frequent pattern mining</h2>\n</div>"}]}},{"text":"transactions.count()\nval fpgrowth = new FPGrowth().setItemsCol(\"items\").setMinSupport(0.1).setMinConfidence(0.4)\nval model = fpgrowth.fit(transactions)","user":"anonymous","dateUpdated":"2020-06-12T10:36:03+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=291","http://172.17.0.2:4040/jobs/job?id=292","http://172.17.0.2:4040/jobs/job?id=293"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1590750880281_-470861645","id":"20200529-111440_895362572","dateCreated":"2020-05-29T11:14:40+0000","dateStarted":"2020-06-12T10:36:03+0000","dateFinished":"2020-06-12T10:36:09+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3053","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"fpgrowth: org.apache.spark.ml.fpm.FPGrowth = fpgrowth_aa4476f515c2\nmodel: org.apache.spark.ml.fpm.FPGrowthModel = fpgrowth_aa4476f515c2\n"}]}},{"text":"%md\n## Frequent items sets","user":"anonymous","dateUpdated":"2020-06-12T10:36:09+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1590936910680_753181140","id":"20200531-145510_333750401","dateCreated":"2020-05-31T14:55:10+0000","dateStarted":"2020-06-12T10:36:09+0000","dateFinished":"2020-06-12T10:36:09+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3054","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Frequent items sets</h2>\n</div>"}]}},{"text":"val freqItems = model.freqItemsets\nfreqItems.cache()\n\nfreqItems.show(5)\nfreqItems.count()","user":"anonymous","dateUpdated":"2020-06-12T10:36:09+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=294","http://172.17.0.2:4040/jobs/job?id=295"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1591267780338_1292045914","id":"20200604-104940_1657700352","dateCreated":"2020-06-04T10:49:40+0000","dateStarted":"2020-06-12T10:36:09+0000","dateFinished":"2020-06-12T10:36:34+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3055","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+----+\n|    items|freq|\n+---------+----+\n|[1000481]|2481|\n|[1000557]|2378|\n|      [1]|2956|\n| [1, 979]|2242|\n|     [78]|2812|\n+---------+----+\nonly showing top 5 rows\n\nfreqItems: org.apache.spark.sql.DataFrame = [items: array<int>, freq: bigint]\nres35: Long = 879\n"}]}},{"text":"%md\n### Association rules","user":"anonymous","dateUpdated":"2020-06-12T10:36:35+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591353073692_-479159543","id":"20200605-103113_142095309","dateCreated":"2020-06-05T10:31:13+0000","dateStarted":"2020-06-12T10:36:35+0000","dateFinished":"2020-06-12T10:36:35+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3056","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Association rules</h3>\n</div>"}]}},{"text":"%spark\n// Display generated association rules.\nval associationRules = model.associationRules\nassociationRules.cache()\nassociationRules.show(10)\nassociationRules.count()","user":"anonymous","dateUpdated":"2020-06-12T10:36:35+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=296","http://172.17.0.2:4040/jobs/job?id=297"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1591268078316_1058846978","id":"20200604-105438_1198090082","dateCreated":"2020-06-04T10:54:38+0000","dateStarted":"2020-06-12T10:36:35+0000","dateFinished":"2020-06-12T10:36:35+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3057","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+----------+-------------------+\n|antecedent|consequent|         confidence|\n+----------+----------+-------------------+\n|[82, 1177]|     [979]| 0.8079347423062663|\n| [1001412]| [1000123]|0.49250771264874393|\n| [1001412]| [1000052]| 0.5176289114147201|\n| [1001412]| [1000062]| 0.5288673424416043|\n| [1001412]|     [976]| 0.5533274570295285|\n| [1001412]|    [4267]| 0.6646099603349493|\n| [1001412]|    [1274]| 0.5914499779638608|\n| [1001412]|    [3327]| 0.5343763772587042|\n| [1001412]| [1000024]|0.48016747465843984|\n| [1001412]| [1000113]|0.49537241075363597|\n+----------+----------+-------------------+\nonly showing top 10 rows\n\nassociationRules: org.apache.spark.sql.DataFrame = [antecedent: array<int>, consequent: array<int> ... 1 more field]\nres36: Long = 1277\n"}]}},{"text":"//show association rules with artist name instead of id\nassociationRules.\n    sort($\"confidence\".desc).\n    limit(10).\n    withColumn(\"antecedent\", concat_ws(\",\", $\"antecedent\")).\n    withColumn(\"consequent\", concat_ws(\",\", $\"consequent\")).\n    collect().foreach { row =>\n        println(row)\n        val ante = row.get(0).toString()\n        val conse = row.get(1).toString()\n        val ante_array = ante.split(\",\").map(_.toInt)\n        val conse_array = conse.split(\",\").map(_.toInt)\n        for(i <- 0 until ante_array.length) {\n            val name = artistByID.filter(artistByID(\"id\").equalTo(ante_array(i))).select(\"name\").collectAsList().get(0).get(0)\n            print(name + \", \")\n        }\n        print(\" -> \")\n        for(i <- 0 until conse_array.length) {\n            val name = artistByID.filter(artistByID(\"id\").equalTo(conse_array(i))).select(\"name\").collectAsList().get(0).get(0)\n            print(name)\n        }\n        print(\"\\n\")\n}","user":"anonymous","dateUpdated":"2020-06-12T10:36:35+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=298","http://172.17.0.2:4040/jobs/job?id=299","http://172.17.0.2:4040/jobs/job?id=300","http://172.17.0.2:4040/jobs/job?id=301","http://172.17.0.2:4040/jobs/job?id=302","http://172.17.0.2:4040/jobs/job?id=303","http://172.17.0.2:4040/jobs/job?id=304","http://172.17.0.2:4040/jobs/job?id=305","http://172.17.0.2:4040/jobs/job?id=306","http://172.17.0.2:4040/jobs/job?id=307","http://172.17.0.2:4040/jobs/job?id=308","http://172.17.0.2:4040/jobs/job?id=309","http://172.17.0.2:4040/jobs/job?id=310","http://172.17.0.2:4040/jobs/job?id=311","http://172.17.0.2:4040/jobs/job?id=312","http://172.17.0.2:4040/jobs/job?id=313","http://172.17.0.2:4040/jobs/job?id=314","http://172.17.0.2:4040/jobs/job?id=315","http://172.17.0.2:4040/jobs/job?id=316","http://172.17.0.2:4040/jobs/job?id=317","http://172.17.0.2:4040/jobs/job?id=318","http://172.17.0.2:4040/jobs/job?id=319","http://172.17.0.2:4040/jobs/job?id=320","http://172.17.0.2:4040/jobs/job?id=321","http://172.17.0.2:4040/jobs/job?id=322","http://172.17.0.2:4040/jobs/job?id=323","http://172.17.0.2:4040/jobs/job?id=324","http://172.17.0.2:4040/jobs/job?id=325","http://172.17.0.2:4040/jobs/job?id=326","http://172.17.0.2:4040/jobs/job?id=327","http://172.17.0.2:4040/jobs/job?id=328"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1591353121713_-2053493584","id":"20200605-103201_86989224","dateCreated":"2020-06-05T10:32:01+0000","dateStarted":"2020-06-12T10:36:36+0000","dateFinished":"2020-06-12T10:36:50+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3058","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[352,1177,979,0.8645339652448657]\nBeck, Coldplay,  -> Radiohead\n[352,1307,979,0.843316144387148]\nBeck, The White Stripes,  -> Radiohead\n[1001646,1177,979,0.8378378378378378]\nThe Smashing Pumpkins, Coldplay,  -> Radiohead\n[352,3327,979,0.8362779740871613]\nBeck, Weezer,  -> Radiohead\n[1001646,1307,979,0.8283378746594006]\nThe Smashing Pumpkins, The White Stripes,  -> Radiohead\n[1001646,1275996,979,0.8282633808240277]\nThe Smashing Pumpkins, R.E.M.,  -> Radiohead\n[234,1000113,979,0.823134328358209]\nPixies, The Beatles,  -> Radiohead\n[1001779,1000113,979,0.8190219484020023]\nModest Mouse, The Beatles,  -> Radiohead\n[352,1000113,979,0.8182748039549949]\nBeck, The Beatles,  -> Radiohead\n[1001646,1000113,979,0.8157984337759618]\nThe Smashing Pumpkins, The Beatles,  -> Radiohead\n"}]}},{"user":"anonymous","dateUpdated":"2020-06-12T10:42:30+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591354178853_-1002192343","id":"20200605-104938_1494816801","dateCreated":"2020-06-05T10:49:38+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3059","text":"associationRules.createOrReplaceTempView(\"assRules\")\n\n//show association rules of artist 1275996 = R.E.M\nspark.sql(\"select * from assRules where array_contains(antecedent, 1275996)\").\n    sort($\"confidence\".desc).\n    limit(10).\n    withColumn(\"antecedent\", concat_ws(\",\", $\"antecedent\")).\n    withColumn(\"consequent\", concat_ws(\",\", $\"consequent\")).\n    collect().foreach { row =>\n        println(row)\n        val ante = row.get(0).toString()\n        val conse = row.get(1).toString()\n        val ante_array = ante.split(\",\").map(_.toInt)\n        val conse_array = conse.split(\",\").map(_.toInt)\n        for(i <- 0 until ante_array.length) {\n            val name = artistByID.filter(artistByID(\"id\").equalTo(ante_array(i))).select(\"name\").collectAsList().get(0).get(0)\n            print(name + \", \")\n        }\n        print(\" -> \")\n        for(i <- 0 until conse_array.length) {\n            val name = artistByID.filter(artistByID(\"id\").equalTo(conse_array(i))).select(\"name\").collectAsList().get(0).get(0)\n            print(name)\n        }\n        print(\"\\n\")\n}","dateFinished":"2020-06-12T10:42:38+0000","dateStarted":"2020-06-12T10:42:30+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[1001646,1275996,979,0.8282633808240277]\nThe Smashing Pumpkins, R.E.M.,  -> Radiohead\n[1275996,1177,979,0.7941849068931721]\nR.E.M., Coldplay,  -> Radiohead\n[1275996,976,979,0.7806596221581812]\nR.E.M., Nirvana,  -> Radiohead\n[1275996,1000113,979,0.7665625]\nR.E.M., The Beatles,  -> Radiohead\n[1275996,1274,979,0.7615587846763541]\nR.E.M., Red Hot Chili Peppers,  -> Radiohead\n[1275996,1205,979,0.7507172457762193]\nR.E.M., U2,  -> Radiohead\n[1275996,4267,979,0.7412831241283124]\nR.E.M., Green Day,  -> Radiohead\n[1275996,1274,976,0.737450462351387]\nR.E.M., Red Hot Chili Peppers,  -> Nirvana\n[1275996,1177,1205,0.7180659915060438]\nR.E.M., Coldplay,  -> U2\n[1275996,976,1274,0.7150176112712135]\nR.E.M., Nirvana,  -> Red Hot Chili Peppers\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=329","http://172.17.0.2:4040/jobs/job?id=330","http://172.17.0.2:4040/jobs/job?id=331","http://172.17.0.2:4040/jobs/job?id=332","http://172.17.0.2:4040/jobs/job?id=333","http://172.17.0.2:4040/jobs/job?id=334","http://172.17.0.2:4040/jobs/job?id=335","http://172.17.0.2:4040/jobs/job?id=336","http://172.17.0.2:4040/jobs/job?id=337","http://172.17.0.2:4040/jobs/job?id=338","http://172.17.0.2:4040/jobs/job?id=339","http://172.17.0.2:4040/jobs/job?id=340","http://172.17.0.2:4040/jobs/job?id=341","http://172.17.0.2:4040/jobs/job?id=342","http://172.17.0.2:4040/jobs/job?id=343","http://172.17.0.2:4040/jobs/job?id=344","http://172.17.0.2:4040/jobs/job?id=345","http://172.17.0.2:4040/jobs/job?id=346","http://172.17.0.2:4040/jobs/job?id=347","http://172.17.0.2:4040/jobs/job?id=348","http://172.17.0.2:4040/jobs/job?id=349","http://172.17.0.2:4040/jobs/job?id=350","http://172.17.0.2:4040/jobs/job?id=351","http://172.17.0.2:4040/jobs/job?id=352","http://172.17.0.2:4040/jobs/job?id=353","http://172.17.0.2:4040/jobs/job?id=354","http://172.17.0.2:4040/jobs/job?id=355","http://172.17.0.2:4040/jobs/job?id=356","http://172.17.0.2:4040/jobs/job?id=357","http://172.17.0.2:4040/jobs/job?id=358","http://172.17.0.2:4040/jobs/job?id=359"],"interpreterSettingId":"spark"}}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591958550481_-774422698","id":"20200612-104230_354861464","dateCreated":"2020-06-12T10:42:30+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:6876"}],"name":"MBA_audioscrobbler","id":"2F9SCURCS","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}